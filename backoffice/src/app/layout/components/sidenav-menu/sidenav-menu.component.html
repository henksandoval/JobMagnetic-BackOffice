<nav class="navigation-list" [class.collapsed]="collapsed">
  @for (item of navigationService.menuItems(); track item.route) {
    @if (item.children && item.children.length > 0) {
      @if (!collapsed) {
        <div class="nav-group mx-3 mb-2">
          <app-nav-link
            [label]="item.label"
            [icon]="item.icon"
            [isParent]="true"
            [isExpanded]="navigationService.isMenuExpanded(item.route)"
            (toggled)="toggleSubmenu(item.route)"
          ></app-nav-link>
          @if (navigationService.isMenuExpanded(item.route)) {
            <div class="submenu mt-1 mb-2 ml-4 pl-4 border-l border-zinc-200 dark:border-zinc-700">
              @for (child of item.children; track child.route) {
                <a
                  mat-list-item
                  [routerLink]="child.route"
                  routerLinkActive="active-link"
                  class="nav-item child-item flex items-center py-3 px-4 my-1 rounded-lg no-underline text-zinc-600 dark:text-zinc-400 hover:bg-black/5 dark:hover:bg-white/5 transition-colors duration-200
                         [&.active-link]:bg-purple-100 dark:[&.active-link]:bg-purple-900/60
                         [&.active-link]:text-purple-700 dark:[&.active-link]:text-purple-300
                         [&.active-link]:font-semibold"
                >
                  <mat-icon *ngIf="child.icon" matListItemIcon class="mr-4 text-xl">{{ child.icon }}</mat-icon>
                  <span matListItemTitle class="text-sm">{{ child.label }}</span>
                </a>
              }
            </div>
          }
        </div>
      } @else {
        <div
          class="group relative"
          (mouseenter)="updateFloatingMenuPosition($event)"
          (mouseleave)="hideFloatingMenuDelayed()"
        >
          <app-nav-link [icon]="item.icon" [isCollapsed]="true"></app-nav-link>
          <app-floating-panel
            [title]="item.label"
            [positionX]="floatingMenuX"
            [positionY]="floatingMenuY"
            (mouseenter)="showFloatingMenu()"
            (mouseleave)="hideFloatingMenuDelayed()"
          >
            @for (child of item.children; track child.route) {
              <app-nav-link
                [route]="child.route"
                [label]="child.label"
                [icon]="child.icon"
                variant="floating"
              ></app-nav-link>
            }
          </app-floating-panel>
        </div>
      }
    } @else {
      <app-nav-link
        [route]="item.route"
        [label]="item.label"
        [icon]="item.icon"
        [isCollapsed]="collapsed"
      ></app-nav-link>
    }
  }
</nav>
